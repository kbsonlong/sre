<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>istio - 分类 - 蜷缩的蜗牛</title><link>https://www.alongparty.cn/categories/istio/</link><description>istio - 分类 - 蜷缩的蜗牛</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>kbsonlong@gmail.com (kbsonlong)</managingEditor><webMaster>kbsonlong@gmail.com (kbsonlong)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Tue, 28 Mar 2023 15:10:12 +0800</lastBuildDate><atom:link href="https://www.alongparty.cn/categories/istio/" rel="self" type="application/rss+xml"/><item><title>深入Istio系列 - Envoy配置分析</title><link>https://www.alongparty.cn/posts/18798d/</link><pubDate>Tue, 28 Mar 2023 15:10:12 +0800</pubDate><author>kbsonlong</author><guid>https://www.alongparty.cn/posts/18798d/</guid><description><![CDATA[<h1 id="envoy-初始化配置文件">Envoy 初始化配置文件</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -ti productpage-v1-d4f8dfd97-p8xlb -c istio-proxy -- cat /etc/istio/proxy/envoy-rev.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>配置文件结构</p>
<p></p>]]></description></item><item><title>Istio Proxy Access日志</title><link>https://www.alongparty.cn/posts/5a662f/</link><pubDate>Fri, 17 Mar 2023 13:57:26 +0800</pubDate><author>kbsonlong</author><guid>https://www.alongparty.cn/posts/5a662f/</guid><description><![CDATA[开启 Access 日志 1 2 3 4 5 6 7 8 9 10 apiVersion: v1 kind: ConfigMap metadata: name: istio namespace: istio-system data: mesh: | accessLogEncoding: JSON accessLogFile: /dev/stdout accessLogFormat: &#34;&#34; 格式化 Access 日志 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 { &#34;authority&#34;: &#34;%REQ(:AUTHORITY)%&#34;, &#34;bytes_received&#34;: &#34;%BYTES_RECEIVED%&#34;, &#34;bytes_sent&#34;:]]></description></item><item><title>深入Istio系列-Pilot agent</title><link>https://www.alongparty.cn/posts/3d18d6/</link><pubDate>Fri, 16 Sep 2022 17:25:59 +0800</pubDate><author>kbsonlong</author><guid>https://www.alongparty.cn/posts/3d18d6/</guid><description><![CDATA[<h3 id="查看监听端口和进程">查看监听端口和进程</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">istio-proxy@istio-ingressgateway-799bbc9474-hf7kv:/$ ss -ntlp
</span></span><span class="line"><span class="cl">State           Recv-Q          Send-Q                     Local Address:Port                      Peer Address:Port          Process                                       
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                            127.0.0.1:15000                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>18<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                            127.0.0.1:15004                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;pilot-agent&#34;</span>,pid<span class="o">=</span>1,fd<span class="o">=</span>15<span class="o">))</span>          
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:15021                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>24<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:15021                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>23<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:8080                           0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>40<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:8080                           0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>39<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:15090                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>22<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                              0.0.0.0:15090                          0.0.0.0:*              users:<span class="o">((</span><span class="s2">&#34;envoy&#34;</span>,pid<span class="o">=</span>16,fd<span class="o">=</span>21<span class="o">))</span>               
</span></span><span class="line"><span class="cl">LISTEN          <span class="m">0</span>               <span class="m">128</span>                                    *:15020                                *:*              users:<span class="o">((</span><span class="s2">&#34;pilot-agent&#34;</span>,pid<span class="o">=</span>1,fd<span class="o">=</span>12<span class="o">))</span>          
</span></span><span class="line"><span class="cl">istio-proxy@istio-ingressgateway-799bbc9474-hf7kv:/$ ps -ef <span class="p">|</span>grep pilot-agent
</span></span><span class="line"><span class="cl">istio-p+     <span class="m">1</span>     <span class="m">0</span>  <span class="m">0</span> Sep14 ?        00:01:27 /usr/local/bin/pilot-agent proxy router --domain istio-system.svc.cluster.local --proxyLogLevel<span class="o">=</span>warning --proxyComponentLogLevel<span class="o">=</span>misc:error --log_output_level<span class="o">=</span>default:info
</span></span><span class="line"><span class="cl">istio-p+    <span class="m">74</span>    <span class="m">30</span>  <span class="m">0</span> 09:37 pts/0    00:00:00 grep --color<span class="o">=</span>auto pilot-agent
</span></span></code></pre></td></tr></table>
</div>
</div><figure>
</figure>]]></description></item><item><title>深入Istio系列-Sidecar自动注入</title><link>https://www.alongparty.cn/posts/dd0bd7/</link><pubDate>Sun, 11 Sep 2022 10:29:36 +0800</pubDate><author>kbsonlong</author><guid>https://www.alongparty.cn/posts/dd0bd7/</guid><description><![CDATA[<ul>
<li>
<p>Sidecar 自动注入机制是将 sidecar 代理自动添加到用户创建的 pod。</p>
</li>
<li>
<p>它使用 MutatingWebhook 机制在 pod 创建的时候将 sidecar 的容器和卷添加到每个 pod 的模版里。</p>
</li>
<li>
<p>用户可以通过 webhooks namespaceSelector 机制来限定需要启动自动注入的范围，也可以通过注解的方式针对每个 pod 来单独启用和禁用自动注入功能。</p>
</li>
</ul>
<p>Sidecar 是否会被自动注入取决于下面 3 条配置和 2 条安全规则：</p>]]></description></item></channel></rss>
<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>Karmada多集群管理方案 - 蜷缩的蜗牛</title><meta name=author content="kbsonlong">
<meta name=author-link content><meta name=description content="Kubernetes 衍变 在云原生时代，Kubernetes 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 Kubernetes 作为容器编排系统，其成为容器编排事"><meta name=keywords content="karmada,kubernetes"><meta itemprop=name content="Karmada多集群管理方案"><meta itemprop=description content="Kubernetes 衍变 在云原生时代，Kubernetes 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 Kubernetes 作为容器编排系统，其成为容器编排事"><meta itemprop=datePublished content="2023-11-27T18:19:26+08:00"><meta itemprop=dateModified content="2023-11-27T18:19:26+08:00"><meta itemprop=wordCount content="2285"><meta itemprop=image content="https://kbsonlong.github.io/logo_transparent.png"><meta itemprop=keywords content="karmada,kubernetes,"><meta property="og:title" content="Karmada多集群管理方案"><meta property="og:description" content="Kubernetes 衍变 在云原生时代，Kubernetes 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 Kubernetes 作为容器编排系统，其成为容器编排事"><meta property="og:type" content="article"><meta property="og:url" content="https://kbsonlong.github.io/sre/posts/327727/"><meta property="og:image" content="https://kbsonlong.github.io/logo_transparent.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-27T18:19:26+08:00"><meta property="article:modified_time" content="2023-11-27T18:19:26+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kbsonlong.github.io/logo_transparent.png"><meta name=twitter:title content="Karmada多集群管理方案"><meta name=twitter:description content="Kubernetes 衍变 在云原生时代，Kubernetes 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 Kubernetes 作为容器编排系统，其成为容器编排事"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://kbsonlong.github.io/sre/posts/327727/><link rel=prev href=https://kbsonlong.github.io/sre/posts/a434b9/><link rel=stylesheet href=/sre/lib/normalize/normalize.min.css><link rel=stylesheet href=/sre/css/style.min.css><link rel=stylesheet href=/sre/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/sre/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Karmada多集群管理方案","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/kbsonlong.github.io\/sre\/posts\/327727\/"},"genre":"posts","keywords":"karmada, kubernetes","wordcount":2285,"url":"https:\/\/kbsonlong.github.io\/sre\/posts\/327727\/","datePublished":"2023-11-27T18:19:26+08:00","dateModified":"2023-11-27T18:19:26+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"kbsonlong"},"description":""}</script></head><body header-desktop=sticky header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper github-corner=right><div class=header-title><a href=/sre/ title=蜷缩的蜗牛><img class="lazyload logo" src=/sre/svg/loading.min.svg data-src=/logo_transparent.png data-srcset="/logo_transparent.png, /logo_transparent.png 1.5x, /logo_transparent.png 2x" data-sizes=auto alt=蜷缩的蜗牛 title=蜷缩的蜗牛><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/sre/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/sre/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/sre/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/sre/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/sre/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/sre/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/sre/messages/ title=留言板>留言板</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/sre/ title=蜷缩的蜗牛><img class="lazyload logo" src=/sre/svg/loading.min.svg data-src=/logo_transparent.png data-srcset="/logo_transparent.png, /logo_transparent.png 1.5x, /logo_transparent.png 2x" data-sizes=auto alt=/logo_transparent.png title=/logo_transparent.png><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/sre/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/sre/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/sre/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/sre/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/sre/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/sre/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/sre/messages/ title=留言板>留言板</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i>
</span><select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Karmada多集群管理方案</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img class="lazyload avatar" src=/sre/svg/loading.min.svg data-src="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp" data-srcset="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 2x" data-sizes=auto alt=kbsonlong title=kbsonlong>&nbsp;kbsonlong</span></span>
<span class=post-category>收录于 <a href=/sre/categories/%E5%A4%9A%E9%9B%86%E7%BE%A4/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;多集群</a>&ensp;<a href=/sre/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;云原生</a></span></div><div class=post-meta-line><span title="2023-11-27 18:19:26"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-11-27>2023-11-27</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 2285 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#kubernetes-衍变><code>Kubernetes</code> 衍变</a><ul><li><a href=#单-kubernetes-集群到多-kubernetes-集群>单 <code>Kubernetes</code> 集群到多 <code>Kubernetes</code> 集群</a></li><li><a href=#多-kubernetes-集群到-kubernetes-多集群>多 <code>Kubernetes</code> 集群到 <code>Kubernetes</code> 多集群</a></li></ul></li><li><a href=#解决方案>解决方案</a><ul><li><a href=#集群管理复杂性>集群管理复杂性</a></li><li><a href=#应用管理>应用管理</a></li><li><a href=#跨集群网络和服务通信>跨集群网络和服务通信</a></li></ul></li><li><a href=#karmada-是什么><code>Karmada</code> 是什么?</a></li><li><a href=#karmada-架构><code>Karmada</code> 架构</a></li><li><a href=#karmada-控制平面组件><code>Karmada</code> 控制平面组件</a><ul><li><a href=#karmada-api-server>Karmada API Server</a></li><li><a href=#karmada-controller-manager>Karmada Controller Manager</a></li><li><a href=#karmada-scheduler>Karmada Scheduler</a></li><li><a href=#etcd>ETCD</a></li></ul></li><li><a href=#karmada的关键特性>Karmada的关键特性</a><ul><li><a href=#跨云多集群多模式管理>跨云多集群多模式管理</a></li><li><a href=#多策略的多集群调度>多策略的多集群调度</a><ul><li><a href=#自定义集群调度策略>自定义集群调度策略</a></li><li><a href=#跨集群资源重调度>跨集群资源重调度</a></li></ul></li><li><a href=#跨集群服务治理>跨集群服务治理</a></li><li><a href=#全局统一资源视图>全局统一资源视图</a></li></ul></li><li><a href=#karmada-部署方案>Karmada 部署方案</a><ul><li><a href=#复用-kube-apiserver>复用 <code>Kube ApiServer</code></a></li><li><a href=#控制面独立集群>控制面独立集群</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=kubernetes-衍变><code>Kubernetes</code> 衍变</h2><p>在云原生时代，<code>Kubernetes</code> 作为一项核心技术已成为现代应用程序架构的基础，越来越多的企业使用 <code>Kubernetes</code> 作为容器编排系统，其成为容器编排事实标准得益于 <code>Kubernetes</code> 的主要有以下几个原因：</p><ul><li>自动化: <code>Kubernetes</code> 实现了容器的部署、扩展、负载均衡、故障恢复、滚动更新等操作的自动化，极大地简化了应用程序的管理和维护工作。这种自动化也提升了应用程序的弹性和可用性。</li><li>可移植性: <code>Kubernetes</code> 基于容器的架构模型，使得应用无需重新编码或更新配置就可以在任何云平台、物理机或者虚拟机中运行。</li><li>生态系统: <code>Kubernetes</code> 作为一个成功地开源项目，拥有强大的社区支持和生态系统，使其可以获得更好的创新、优化和安全性保障。从社区中，我们可以找到各种插件和工具，为开发者提供了丰富的选择和扩展性。</li></ul><h3 id=单-kubernetes-集群到多-kubernetes-集群>单 <code>Kubernetes</code> 集群到多 <code>Kubernetes</code> 集群</h3><p>随着企业发展，企业中的应用也变得越来越复杂，需要区分不同环境、多机房、混合云、异地多活、全球各地域数据合规差异等，多 <code>Kubernetes</code> 集群可以在不同的云平台、不同的数据中心、不同的网络环境和不同的物理基础设施中部署，以满足不同的应用程序和业务需求。但随着集群数量的增加，也面临着诸多挑战</p><ul><li>集群管理复杂性</li><li>应用管理成本</li><li>跨集群网络和服务通信</li></ul><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111555.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111555.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111555.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111555.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111555.png title=multi-cluster></p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111700.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111700.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111700.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111700.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128111700.png title=multi-cloud></p><h3 id=多-kubernetes-集群到-kubernetes-多集群>多 <code>Kubernetes</code> 集群到 <code>Kubernetes</code> 多集群</h3><p>为了解决上面的种种挑战，衍变出了 <code>Kubernetes</code> 多集群概念，<code>Kubernetes</code> 多集群和多 <code>Kubernetes</code> 集群是两个不同的概念，社区也将其称为 <code>Kubernetes</code> 联邦。</p><p><code>Kubernetes</code> 联邦是将多个 <code>Kubernetes</code> 集群连接在一起，以便协同工作和实现跨集群资源和应用的统一管理、跨地域和跨云的故障切换、根据实际需求动态分配资源降低成本、提升业务的灵活性和扩展性。</p><h2 id=解决方案>解决方案</h2><h3 id=集群管理复杂性>集群管理复杂性</h3><p>使用集中式的多集群管理平台，在一个统一的界面中管理多云混合云中的 Kubernetes 集群，提供集群创建、配置、监控和故障排查的功能，使集群管理变得更加简单和高效，同时提高集群的可靠性和可用性。例如社区中的 <code>Kubesphere</code> 与 <code>Rancher</code> 和公有云厂商 <code>AWS</code> 的 <code>EKS</code> 、腾讯云的 <code>TKE</code> 、阿里云的 <code>ACK</code> 等。</p><h3 id=应用管理>应用管理</h3><p>使用自动化的多集群应用编排和管理平台，解决多集群、多云环境下应用程序的快速部署、扩展和管理问题，保证应用程序的可靠性。</p><p>除了上面提到多集群管理平台提供了应用管理能力以外，还有如 <code>Kubernetes Federation</code>（发展了2个版本,于 22 年 8 月已存档）、<code>Karmada</code> 和字节开源不久的 <code>KubeAdmiral</code> 等开源多集群应用管理平台。</p><h3 id=跨集群网络和服务通信>跨集群网络和服务通信</h3><p>降低多集群环境中的网络复杂性。使用服务网格技术，管理跨多个集群的服务流量、安全性和可观测性，实现跨集群的服务发现和通信；或者采用跨集群的网络解决方案实现网络互通。</p><p>服务网格技术有 <code>Istio</code>、<code>Linkerd</code>、<code>Flomesh</code> 、<code>Kuma</code>、<code>Mosh</code> 等，网络解决方案有 Submariner。</p><h2 id=karmada-是什么><code>Karmada</code> 是什么?</h2><p>开源解决方案 <code>Karmada</code> 是基于 <code>Kubernetes</code> 的多集群管理方案，支持跨多个 <code>Kubernetes</code> 集群的资源调度、服务发现、负载均衡、故障转移、资源管理、策略执行等功能。</p><h2 id=karmada-架构><code>Karmada</code> 架构</h2><p>Karmada的架构如下图所示:</p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128102208.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128102208.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128102208.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128102208.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128102208.png title=karmada-arch></p><h2 id=karmada-控制平面组件><code>Karmada</code> 控制平面组件</h2><h3 id=karmada-api-server>Karmada API Server</h3><p>Karmada API 服务器是直接使用 Kubernetes 的 kube-apiserver 实现的，因此 Karmada 与 Kubernetes API 自然兼容。 这也使得 Karmada 更容易实现与 Kubernetes 生态系统的集成，例如允许用户使用 kubectl 来操作 Karmada、 与 ArgoCD 集成、与 Flux 集成等等。</p><h3 id=karmada-controller-manager>Karmada Controller Manager</h3><p>Karmada 控制器管理器运行了各种自定义控制器进程。</p><p>控制器负责监视Karmada对象，并与底层集群的API服务器通信，以创建原生的 Kubernetes 资源</p><h3 id=karmada-scheduler>Karmada Scheduler</h3><p>karmada-scheduler 负责将 Kubernetes 原生API资源对象（以及CRD资源）调度到成员集群。</p><p>调度器依据策略约束和可用资源来确定哪些集群对调度队列中的资源是可用的，然后调度器对每个可用集群进行打分排序，并将资源绑定到最合适的集群。</p><h3 id=etcd>ETCD</h3><p>ETCD 存储了 karmada API 对象，API Server 是所有其他组件通讯的 REST 端点，Karmada Controller Manager 根据您通过 API 服务器创建的 API 对象执行操作</p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311281800981.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311281800981.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311281800981.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311281800981.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311281800981.png title=karmada-arch></p><h2 id=karmada的关键特性>Karmada的关键特性</h2><h3 id=跨云多集群多模式管理>跨云多集群多模式管理</h3><ol><li>安全隔离</li></ol><ul><li>为每个集群创建一个 namespace，以karmada-es-为前缀</li></ul><ol start=2><li>多模式</li></ol><ul><li>Push模式</li><li>Pull模式</li></ul><ol start=3><li>多云支持(Kubernetes规范)</li></ol><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103546.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103546.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103546.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103546.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103546.png title=20231128103546></p><h3 id=多策略的多集群调度>多策略的多集群调度</h3><h4 id=自定义集群调度策略>自定义集群调度策略</h4><ol><li>不同 调度策略 下的集群分发能力</li></ol><ul><li>ClusterAffinity：基于 ClusterName、Label、Field 的定向调度。</li><li>Toleration：基于 Taint 和 Toleration 的调度。</li><li>SpreadConstraint：基于集群拓扑的调度。</li><li>ReplicasScheduling：针对有实例的工作负载的复制模式与拆分模式。</li></ul><ol start=2><li>差异化配置（ OverridePolicy ）</li></ol><ul><li>ImageOverrider：镜像的差异化配置。</li><li>ArgsOverrider：运行参数的差异化配置。</li><li>CommandOverrider：运行命令的差异化配置。</li><li>PlainText：自定义的差异化配置。</li></ul><ol start=3><li>支持 重调度</li></ol><ul><li>Descheduler（karmada-descheduler）：根据成员集群内实例状态变化触发重调度。</li><li>Scheduler-estimator(karmada-scheduler-estimator)：为调度器提供更精确的成员集群运行实例的期望状态。</li></ul><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311291102428.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311291102428.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311291102428.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311291102428.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311291102428.png title=overall-scheduling></p><h4 id=跨集群资源重调度>跨集群资源重调度</h4><p>如果一个成员集群没有足够的资源容纳其中的 Pod，Karmada 会重新调度 Pod。整体的重调度流程如下图所示
<img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103604.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103604.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103604.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103604.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103604.png title=overall-rescheduling></p><h3 id=跨集群服务治理>跨集群服务治理</h3><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103511.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103511.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103511.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103511.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103511.png title=应用跨集群故障转移></p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103356.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103356.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103356.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103356.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103356.png title=service-governance></p><h3 id=全局统一资源视图>全局统一资源视图</h3><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103450.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103450.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103450.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103450.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20231128103450.png title=20231128103450></p><h2 id=karmada-部署方案>Karmada 部署方案</h2><h3 id=复用-kube-apiserver>复用 <code>Kube ApiServer</code></h3><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301814539.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301814539.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301814539.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301814539.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301814539.png title=Deploy1></p><ul><li>优点:</li></ul><ol><li>复用 <code>Kube ApiServer</code> 的能力，可以减少 <code>ApiServer</code> 和 <code>ETCD</code> 资源成本;</li></ol><ul><li>不足:</li></ul><ol><li>尚未经过 <code>Karmada</code> 社区的全面测试，社区也没有相关测试计划;</li><li>会增加 <code>Karmada</code> 系统的计算成本,以 <code>Deployment</code> 为例采用 <code>resource template</code> 后，<code>kube-controller</code> 会为 <code>Deployment</code> 创建 Pods 并持续更新状态，<code>Karmada</code> 系统也会协调这些变化，所以可能会发生冲突,详细查看[6];</li><li>架构复杂度高，增加维护难度;</li></ol><h3 id=控制面独立集群>控制面独立集群</h3><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301815543.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301815543.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301815543.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301815543.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/202311301815543.png title=Deploy2></p><ul><li>优点:</li></ul><ol><li>控制面独立于集群,控制面和数据面分离，整体架构清晰，可以方便地进行升级和维护;</li><li>控制面异常不影响业务应用正常运行；</li><li>社区主流方式,社区支持;</li></ol><ul><li>不足:</li></ul><ol><li>资源成本增加;</li></ol><h1 id=参考资料>参考资料</h1><ol><li><a href=https://atbug.com/kubernetes-cluster-evolution-in-multi-hybrid-cloud/ target=_blank rel="external nofollow noopener noreferrer">https://atbug.com/kubernetes-cluster-evolution-in-multi-hybrid-cloud/</a></li><li><a href=https://midbai.com/post/practice-of-karmada-as-cluster-resource-synchronization-in-disaster-recovery-systems/ target=_blank rel="external nofollow noopener noreferrer">https://midbai.com/post/practice-of-karmada-as-cluster-resource-synchronization-in-disaster-recovery-systems/</a></li><li><a href=https://karmada.io/zh/docs/ target=_blank rel="external nofollow noopener noreferrer">https://karmada.io/zh/docs/</a></li><li><a href=https://addozhang.medium.com/application-management-under-hybrid-multi-cloud-with-karmada-3c1db3efd99a target=_blank rel="external nofollow noopener noreferrer">https://addozhang.medium.com/application-management-under-hybrid-multi-cloud-with-karmada-3c1db3efd99a</a></li><li><a href=https://medium.com/expedia-group-tech/karmada-a-multi-cloud-multi-cluster-kubernetes-orchestration-part-1-c53f13c263e5 target=_blank rel="external nofollow noopener noreferrer">https://medium.com/expedia-group-tech/karmada-a-multi-cloud-multi-cluster-kubernetes-orchestration-part-1-c53f13c263e5</a></li><li><a href=https://github.com/karmada-io/karmada/issues/3907 target=_blank rel="external nofollow noopener noreferrer">https://github.com/karmada-io/karmada/issues/3907</a></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-11-27 18:19:26">更新于 2023-11-27</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/sre/posts/327727/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案 data-hashtags=karmada,kubernetes><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://kbsonlong.github.io/sre/posts/327727/ data-hashtag=karmada><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案 data-web><i class="fa-brands fa-whatsapp fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案><i data-svg-src=/sre/lib/simple-icons/icons/line.min.svg></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案><i class="fa-brands fa-weibo fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案 data-description><i data-svg-src=/sre/lib/simple-icons/icons/myspace.min.svg></i></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案 data-description><i class="fa-brands fa-blogger fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://kbsonlong.github.io/sre/posts/327727/ data-title=Karmada多集群管理方案><i class="fa-brands fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/sre/tags/karmada/>karmada</a>,&nbsp;<a href=/sre/tags/kubernetes/>kubernetes</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/sre/>主页</a></span></section></div><div class=post-nav><a href=/sre/posts/a434b9/ class=prev rel=prev title=混沌工程原则><i class="fa-solid fa-angle-left fa-fw"></i>混沌工程原则</a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=kbsonlong/devops.alongparty.cn data-repo-id=R_kgDOHE7F-Q data-category=Announcements data-category-id=DIC_kwDOHE7F-c4CPP5J data-mapping=title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/sre/>kbsonlong</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw"></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider"><a target=_blank href=https://beian.miit.gov.cn/>粤ICP备18122209号</a></span></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><a href=https://github.com/kbsonlong title="在 GitHub 上查看源代码" target=_blank rel="external nofollow noopener noreferrer" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div></div><link rel=stylesheet href=/sre/lib/katex/katex.min.css><link rel=stylesheet href=/sre/lib/katex/copy-tex.min.css><link rel=stylesheet href=/sre/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/sre/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/sre/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/sre/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/sre/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/sre/lib/katex/katex.min.js defer></script><script type=text/javascript src=/sre/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/sre/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/sre/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/sre/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=/sre/lib/pangu/pangu.min.js defer></script><script type=text/javascript src=/sre/lib/cell-watermark/watermark.min.js defer></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,enablePangu:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"WFOR67TML1",algoliaIndex:"along",algoliaSearchKey:"ea1fe535f9a7ae353f3922489c829cc1",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/favicon-16x16.png" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script type=text/javascript src=/sre/js/theme.min.js defer></script><script type=text/javascript src=/sre/js/_custom.min.js defer></script></body></html>
<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>Loki系统架构 - 蜷缩的蜗牛</title><meta name=author content="kbsonlong">
<meta name=author-link content><meta name=description content="Loki 系统架构
"><meta name=keywords content='loki,Grafana'><meta itemprop=name content="Loki系统架构"><meta itemprop=description content="Loki 系统架构
"><meta itemprop=datePublished content="2023-06-15T13:24:56+08:00"><meta itemprop=dateModified content="2023-06-15T13:24:56+08:00"><meta itemprop=wordCount content="1634"><meta itemprop=image content="https://www.kbsonlong.com/sre/logo_transparent.png"><meta itemprop=keywords content="loki,Grafana,"><meta property="og:title" content="Loki系统架构"><meta property="og:description" content="Loki 系统架构
"><meta property="og:type" content="article"><meta property="og:url" content="https://www.kbsonlong.com/sre/posts/c7c7b8/"><meta property="og:image" content="https://www.kbsonlong.com/sre/logo_transparent.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-15T13:24:56+08:00"><meta property="article:modified_time" content="2023-06-15T13:24:56+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.kbsonlong.com/sre/logo_transparent.png"><meta name=twitter:title content="Loki系统架构"><meta name=twitter:description content="Loki 系统架构
"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.kbsonlong.com/sre/posts/c7c7b8/><link rel=prev href=https://www.kbsonlong.com/sre/posts/32dd44/><link rel=next href=https://www.kbsonlong.com/sre/posts/81200000/><link rel=stylesheet href=/sre/lib/normalize/normalize.min.css><link rel=stylesheet href=/sre/css/style.min.css><link rel=stylesheet href=/sre/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/sre/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Loki系统架构","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.kbsonlong.com\/sre\/posts\/c7c7b8\/"},"genre":"posts","keywords":"loki, Grafana","wordcount":1634,"url":"https:\/\/www.kbsonlong.com\/sre\/posts\/c7c7b8\/","datePublished":"2023-06-15T13:24:56+08:00","dateModified":"2023-06-15T13:24:56+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"kbsonlong"},"description":""}</script></head><body header-desktop=sticky header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper github-corner=right><div class=header-title><a href=/sre/ title=蜷缩的蜗牛><img class="lazyload logo" src=/sre/svg/loading.min.svg data-src=/sre/logo_transparent.png data-srcset="/sre/logo_transparent.png, /sre/logo_transparent.png 1.5x, /sre/logo_transparent.png 2x" data-sizes=auto alt=蜷缩的蜗牛 title=蜷缩的蜗牛><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/sre/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/sre/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/sre/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/sre/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/sre/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/sre/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/sre/messages/ title=留言板>留言板</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/sre/ title=蜷缩的蜗牛><img class="lazyload logo" src=/sre/svg/loading.min.svg data-src=/sre/logo_transparent.png data-srcset="/sre/logo_transparent.png, /sre/logo_transparent.png 1.5x, /sre/logo_transparent.png 2x" data-sizes=auto alt=/sre/logo_transparent.png title=/sre/logo_transparent.png><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/sre/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/sre/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/sre/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/sre/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/sre/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/sre/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/sre/messages/ title=留言板>留言板</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i>
</span><select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Loki系统架构</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img class="lazyload avatar" src=/sre/svg/loading.min.svg data-src="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp" data-srcset="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 2x" data-sizes=auto alt=kbsonlong title=kbsonlong>&nbsp;kbsonlong</span></span>
<span class=post-category>收录于 <a href=/sre/categories/%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;监控体系</a></span></div><div class=post-meta-line><span title="2023-06-15 13:24:56"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-06-15>2023-06-15</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 1634 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#loki-组件>Loki 组件</a><ul><li><a href=#distributor-分发器>Distributor (分发器)</a><ul><li><a href=#validation-校验>Validation (校验)</a></li><li><a href=#preprocessing-预处理>Preprocessing (预处理)</a></li><li><a href=#rate-limiting-限速>Rate limiting (限速)</a></li><li><a href=#forwarding-转发>Forwarding (转发)</a></li><li><a href=#replication-factor-副本>Replication factor (副本)</a></li><li><a href=#hashing>Hashing</a></li><li><a href=#quorum-consistency>Quorum consistency</a></li></ul></li><li><a href=#ingester>Ingester</a></li><li><a href=#querier-查询器>Querier (查询器)</a></li><li><a href=#query-frontend>Query frontend</a></li></ul></li><li><a href=#数据处理流程>数据处理流程</a><ul><li><a href=#数据读取>数据读取</a></li><li><a href=#数据写入>数据写入</a></li></ul></li><li><a href=#部署模式>部署模式</a><ul><li><a href=#单体模式>单体模式</a></li><li><a href=#读写分离模式>读写分离模式</a></li><li><a href=#微服务模式>微服务模式</a></li></ul></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></div><div class=content id=content><h1 id=loki-系统架构>Loki 系统架构</h1><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614180902.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614180902.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614180902.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614180902.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614180902.png title=loki-architecture></p><h2 id=loki-组件>Loki 组件</h2><h3 id=distributor-分发器>Distributor (分发器)</h3><p><code>Distributor</code> 服务负责处理客户端写入的日志，它本质上是日志数据写入路径中的入口，一旦 <code>Distributor</code> 收到日志数据，会将其拆分为多个批次，然后并行发送给多个 <code>Ingester</code> 。 <code>Distributor</code> 通过 <code>gRPC</code> 与 <code>Ingester</code> 通信，它们都是无状态的，所以可以根据需要扩大或缩小规模。</p><h4 id=validation-校验>Validation (校验)</h4><p><code>Distributor</code> 第一步是确保所有传入数据均符合规范。这包括检查标签是否是有效的 Prometheus 标签，以及确保时间戳不会太旧或太新，或者日志行不会太长。</p><h4 id=preprocessing-预处理>Preprocessing (预处理)</h4><p>规范化标签,对标签进行排序,从而能够准确的命中 <code>cache</code> 和 <code>hash</code>。</p><h4 id=rate-limiting-限速>Rate limiting (限速)</h4><p><code>Distributor</code> 可以根据每个租户的最大比特率对传入日志进行速率限制。 它通过检查每个租户的限制并将其除以当前的 <code>Distributor</code> 数量。 这允许在集群级别为每个租户指定速率限制，并使我们能够向上或向下扩展 <code>Distributor</code>，并相应地调整每个 <code>Distributor</code> 的限制</p><h4 id=forwarding-转发>Forwarding (转发)</h4><p><code>Distributor</code> 验证通过后，它就会将数据转发到最终负责确认写入的 <code>Ingester</code> 组件。</p><h4 id=replication-factor-副本>Replication factor (副本)</h4><p>为了减少在任何单个 <code>Ingester</code> 上丢失数据的机会，<code>Distributor</code> 会将写入转发到它们的 <code>replication_factor</code> 。默认 <code>3</code> 副本。副本允许 <code>Ingester</code> 重新启动和推出而不会导致写入失败，并在某些情况下增加额外的数据丢失保护。</p><p>floor(replication_factor / 2) + 1</p><h4 id=hashing>Hashing</h4><p><code>Distributor</code> 将一致性Hash和可配置的复制因子结合使用，以确定 <code>Ingester</code> 服务的哪些实例应该接收指定的数据流。</p><p>流是一组与租户和唯一标签集关联的日志，使用租户 ID 和标签集对流进行 hash 处理，然后使用哈希查询要发送流的 <code>Ingester</code></p><h4 id=quorum-consistency>Quorum consistency</h4><h3 id=ingester>Ingester</h3><p><code>Ingester</code> 服务负责将日志数据写入存储后端（DynamoDB、S3、Cassandra ）。此外 <code>Ingester</code> 会验证摄取的日志行是否按照时间戳递增的顺序接收的（即每条日志的时间戳都比前面的日志晚一些），当 <code>Ingester</code> 收到不符合这个顺序的日志时，该日志行会被拒绝并返回一个错误。</p><ul><li><p>如果传入的行与之前收到的行完全匹配（与之前的时间戳和日志文本都匹配），传入的行将被视为完全重复并被忽略。</p></li><li><p>如果传入的行与前一行的时间戳相同，但内容不同，则接受该日志行，表示同一时间戳有两个不同的日志行是可能的。</p></li></ul><h3 id=querier-查询器>Querier (查询器)</h3><p><code>Querier</code> 接收日志数据查询、聚合统计请求，使用 <code>LogQL</code> 查询语言处理查询，从 <code>ingester</code> 和长期存储中获取日志。</p><p>查询器查询所有 <code>ingester</code> 的内存数据，然后再到后端存储运行相同的查询。由于复制因子，查询器有可能会收到重复的数据。为了解决这个问题，查询器在内部对具有相同纳秒时间戳、标签集和日志信息的数据进行重复数据删除。</p><h3 id=query-frontend>Query frontend</h3><p><code>Query Frontend</code> 查询前端是一个可选的服务，可以用来加速读取路径。当查询前端就位时，将传入的查询请求定向到查询前端，而不是 <code>querier</code>, 为了执行实际的查询，群集中仍需要 <code>querier</code> 服务。</p><p>查询前端在内部执行一些查询调整，并在内部队列中保存查询。<code>querier</code> 作为 <code>workers</code> 从队列中提取作业，执行它们，并将它们返回到查询前端进行汇总。<code>querier</code> 需要配置查询前端地址，以便允许它们连接到查询前端。</p><p>查询前端是无状态的，然而，由于内部队列的工作方式，建议运行几个查询前台的副本，以获得公平调度的好处，在大多数情况下，两个副本应该足够了。</p><h2 id=数据处理流程>数据处理流程</h2><h3 id=数据读取>数据读取</h3><ol><li>查询器收到一个 HTTP/1 数据请求。</li><li>查询器将查询传递给内存中数据的所有 <code>Ingester</code> 。</li><li><code>Ingester</code> 接收读取请求并返回与查询匹配的数据（如果有）。</li><li>如果没有 <code>Ingester</code> 返回数据，查询器会从后备存储中延迟加载数据并对其运行查询。</li><li>查询器遍历所有接收到的数据并删除重复数据，通过 HTTP/1 连接返回一组最终数据。</li></ol><h3 id=数据写入>数据写入</h3><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614175539.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614175539.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614175539.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614175539.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614175539.png title=loki-write></p><ol><li><code>Distributor</code>收到 HTTP/1 请求以存储流数据。</li><li>每个流都使用哈希环进行哈希处理。</li><li><code>Distributor</code>将每个流发送到适当的<code>Ingester</code>及其副本（基于配置的复制因子）。</li><li>每个<code>Ingester</code>将为流的数据创建一个块或附加到现有块。每个租户和每个标签集的块都是唯一的。</li><li>分发者通过 HTTP/1 连接以成功代码响应。</li></ol><h2 id=部署模式>部署模式</h2><h3 id=单体模式>单体模式</h3><p>单体模式适用于快速开始体验 Loki 进行实验以及每天最多约 100GB 的小读/写量场景。</p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614165956.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614165956.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614165956.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614165956.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614165956.png title=loki-all></p><h3 id=读写分离模式>读写分离模式</h3><p>当日志量每天超过几百 GB，或者希望分离读写，Loki 提供了简单的读写分离可扩展部署模式。这种部署模式可以扩展到每天数 TB 的日志。</p><p><img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170049.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170049.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170049.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170049.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170049.png title=loki-read-write></p><h3 id=微服务模式>微服务模式</h3><p>每个组件独立部署，适用于超大型日志收集。
<img class=lazyload src=/sre/svg/loading.min.svg data-src=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170128.png data-srcset="https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170128.png, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170128.png 1.5x, https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170128.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/kbsonlong/notes_statics/master/images/20230614170128.png title=loki-Microservices></p><h2 id=参考资料>参考资料</h2><p><a href=https://juejin.cn/post/6963452646216695845 target=_blank rel="external nofollow noopener noreferrer">Loki生产环境集群方案</a></p><p><a href=https://grafana.com/docs/loki/latest/ target=_blank rel="external nofollow noopener noreferrer">Loki官方文档</a></p><p><a href=https://grafana.com/docs/loki/latest/logql/ target=_blank rel="external nofollow noopener noreferrer">Loki查询语法</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-06-15 13:24:56">更新于 2023-06-15</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/sre/posts/c7c7b8/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构 data-hashtags=loki,Grafana><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-hashtag=loki><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构 data-web><i class="fa-brands fa-whatsapp fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构><i data-svg-src=/sre/lib/simple-icons/icons/line.min.svg></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构><i class="fa-brands fa-weibo fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构 data-description><i data-svg-src=/sre/lib/simple-icons/icons/myspace.min.svg></i></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构 data-description><i class="fa-brands fa-blogger fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.kbsonlong.com/sre/posts/c7c7b8/ data-title=Loki系统架构><i class="fa-brands fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/sre/tags/loki/>Loki</a>,&nbsp;<a href=/sre/tags/grafana/>Grafana</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/sre/>主页</a></span></section></div><div class=post-nav><a href=/sre/posts/32dd44/ class=prev rel=prev title="源码分析 kubernetes hpa controller 水平自动扩缩容的实现原理"><i class="fa-solid fa-angle-left fa-fw"></i>源码分析 kubernetes hpa controller 水平自动扩缩容的实现原理</a>
<a href=/sre/posts/81200000/ class=next rel=next title=Loki快速使用>Loki快速使用<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=kbsonlong/devops.alongparty.cn data-repo-id=R_kgDOHE7F-Q data-category=Announcements data-category-id=DIC_kwDOHE7F-c4CPP5J data-mapping=title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2018 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/sre/>kbsonlong</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw"></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider"><a target=_blank href=https://beian.miit.gov.cn/>粤ICP备18122209号</a></span></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><a href=https://github.com/kbsonlong title="在 GitHub 上查看源代码" target=_blank rel="external nofollow noopener noreferrer" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div></div><link rel=stylesheet href=/sre/lib/katex/katex.min.css><link rel=stylesheet href=/sre/lib/katex/copy-tex.min.css><link rel=stylesheet href=/sre/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/sre/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/sre/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/sre/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/sre/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/sre/lib/katex/katex.min.js defer></script><script type=text/javascript src=/sre/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/sre/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/sre/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/sre/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=/sre/lib/pangu/pangu.min.js defer></script><script type=text/javascript src=/sre/lib/cell-watermark/watermark.min.js defer></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,enablePangu:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"WFOR67TML1",algoliaIndex:"along",algoliaSearchKey:"ea1fe535f9a7ae353f3922489c829cc1",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/favicon-16x16.png" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script type=text/javascript src=/sre/js/theme.min.js defer></script><script type=text/javascript src=/sre/js/_custom.min.js defer></script></body></html>
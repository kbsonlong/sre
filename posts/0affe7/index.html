<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Envoy性能指标 - 蜷缩的蜗牛</title><meta name=author content="kbsonlong"><meta name=author-link content><meta name=description content="Envoy 指标
Envoy 指标概述
Envoy 的主要目标之一是使网络易于理解。 Envoy 会根据其配置方式产生大量统计信息。一般来说，统计数据(指标)分为三类：

Downstream：Downstream 指标与外来的连接/请求有关。它们由 listener、HTTP connection manager(HCM)、TCP proxy filter 等产生。
Upstream：Upstream 指标与外向的连接/请求有关。它们由 connection pool、router filter、tcp proxy filter等产生。
Server：Server 指标信息描述 Envoy 服务器实例的运作情况。服务器正常运行时间或分配的内存量等统计信息。

在最简单场景下，单个 Envoy Proxy 通常涉及 Downstream 和 Upstream 统计数据。这两种指标反映了取该 网络节点 的运行情况。来自整个网格的统计数据提供了每个 网络节点 和整体网络健康状况的非常详细的汇总信息。Envoy 的文档对这些指标有一些简单的说明。"><meta name=keywords content="istio,envoy,转载"><meta itemprop=name content="Envoy性能指标"><meta itemprop=description content="Envoy 指标
Envoy 指标概述
Envoy 的主要目标之一是使网络易于理解。 Envoy 会根据其配置方式产生大量统计信息。一般来说，统计数据(指标)分为三类：

Downstream：Downstream 指标与外来的连接/请求有关。它们由 listener、HTTP connection manager(HCM)、TCP proxy filter 等产生。
Upstream：Upstream 指标与外向的连接/请求有关。它们由 connection pool、router filter、tcp proxy filter等产生。
Server：Server 指标信息描述 Envoy 服务器实例的运作情况。服务器正常运行时间或分配的内存量等统计信息。

在最简单场景下，单个 Envoy Proxy 通常涉及 Downstream 和 Upstream 统计数据。这两种指标反映了取该 网络节点 的运行情况。来自整个网格的统计数据提供了每个 网络节点 和整体网络健康状况的非常详细的汇总信息。Envoy 的文档对这些指标有一些简单的说明。"><meta itemprop=datePublished content="2022-09-13T10:46:39+08:00"><meta itemprop=dateModified content="2022-09-13T10:46:39+08:00"><meta itemprop=wordCount content="3149"><meta itemprop=image content="https://www.alongparty.cn/logo_transparent.png"><meta itemprop=keywords content="istio,envoy,转载,"><meta property="og:title" content="Envoy性能指标"><meta property="og:description" content="Envoy 指标
Envoy 指标概述
Envoy 的主要目标之一是使网络易于理解。 Envoy 会根据其配置方式产生大量统计信息。一般来说，统计数据(指标)分为三类：

Downstream：Downstream 指标与外来的连接/请求有关。它们由 listener、HTTP connection manager(HCM)、TCP proxy filter 等产生。
Upstream：Upstream 指标与外向的连接/请求有关。它们由 connection pool、router filter、tcp proxy filter等产生。
Server：Server 指标信息描述 Envoy 服务器实例的运作情况。服务器正常运行时间或分配的内存量等统计信息。

在最简单场景下，单个 Envoy Proxy 通常涉及 Downstream 和 Upstream 统计数据。这两种指标反映了取该 网络节点 的运行情况。来自整个网格的统计数据提供了每个 网络节点 和整体网络健康状况的非常详细的汇总信息。Envoy 的文档对这些指标有一些简单的说明。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.alongparty.cn/posts/0affe7/"><meta property="og:image" content="https://www.alongparty.cn/logo_transparent.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-13T10:46:39+08:00"><meta property="article:modified_time" content="2022-09-13T10:46:39+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.alongparty.cn/logo_transparent.png"><meta name=twitter:title content="Envoy性能指标"><meta name=twitter:description content="Envoy 指标
Envoy 指标概述
Envoy 的主要目标之一是使网络易于理解。 Envoy 会根据其配置方式产生大量统计信息。一般来说，统计数据(指标)分为三类：

Downstream：Downstream 指标与外来的连接/请求有关。它们由 listener、HTTP connection manager(HCM)、TCP proxy filter 等产生。
Upstream：Upstream 指标与外向的连接/请求有关。它们由 connection pool、router filter、tcp proxy filter等产生。
Server：Server 指标信息描述 Envoy 服务器实例的运作情况。服务器正常运行时间或分配的内存量等统计信息。

在最简单场景下，单个 Envoy Proxy 通常涉及 Downstream 和 Upstream 统计数据。这两种指标反映了取该 网络节点 的运行情况。来自整个网格的统计数据提供了每个 网络节点 和整体网络健康状况的非常详细的汇总信息。Envoy 的文档对这些指标有一些简单的说明。"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.alongparty.cn/posts/0affe7/><link rel=prev href=https://www.alongparty.cn/posts/6be15f/><link rel=next href=https://www.alongparty.cn/posts/6899d1/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Envoy性能指标","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.alongparty.cn\/posts\/0affe7\/"},"genre":"posts","keywords":"istio, envoy, 转载","wordcount":3149,"url":"https:\/\/www.alongparty.cn\/posts\/0affe7\/","datePublished":"2022-09-13T10:46:39+08:00","dateModified":"2022-09-13T10:46:39+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"kbsonlong"},"description":""}</script></head><body header-desktop=sticky header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper github-corner=right><div class=header-title><a href=/ title=蜷缩的蜗牛><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo_transparent.png data-srcset="/logo_transparent.png, /logo_transparent.png 1.5x, /logo_transparent.png 2x" data-sizes=auto alt=蜷缩的蜗牛 title=蜷缩的蜗牛><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li></ul></nav></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=蜷缩的蜗牛><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo_transparent.png data-srcset="/logo_transparent.png, /logo_transparent.png 1.5x, /logo_transparent.png 2x" data-sizes=auto alt=/logo_transparent.png title=/logo_transparent.png><span class=header-title-text>蜷缩的蜗牛</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class='fa-solid fa-archive fa-fw fa-sm'></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fa-solid fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fa-solid fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fa-solid fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fa-solid fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=https://github.com/kbsonlong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw'></i></a></li><li class="menu-item d-none-desktop text-center"><a class=menu-link href=/messages/><i class='fa-solid fa-messages'></i> 留言板</a></li><li class=menu-item><a class=menu-link href=/messages/ title=留言板>留言板</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw"></i></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down"></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Envoy性能指标</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp" data-srcset="https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 1.5x, https://gravatar.loli.net/avatar/598872715ec08296cf1e1806135cd518?s=32&amp;d=mp 2x" data-sizes=auto alt=kbsonlong title=kbsonlong>&nbsp;kbsonlong</span></span>
<span class=post-category>收录于 <a href=/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;云原生</a></span></div><div class=post-meta-line><span title="2022-09-13 10:46:39"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-09-13>2022-09-13</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 3149 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#envoy-指标概述>Envoy 指标概述</a><ul><li><a href=#tag>Tag</a></li><li><a href=#指标数据类型>指标数据类型</a></li></ul></li><li><a href=#指标释义>指标释义</a><ul><li><a href=#cluster-manager>cluster manager</a></li><li><a href=#http-connection-managerhcm>http connection manager(HCM)</a></li><li><a href=#listeners>listeners</a></li><li><a href=#server>server</a></li><li><a href=#watch-dog>watch dog</a></li><li><a href=#event-loop>Event loop</a></li></ul></li><li><a href=#配置说明>配置说明</a><ul><li><a href=#configbootstrapv3bootstrap>config.bootstrap.v3.Bootstrap</a></li><li><a href=#configmetricsv3statsconfig>config.metrics.v3.StatsConfig</a></li><li><a href=#configmetricsv3statsmatcher>config.metrics.v3.StatsMatcher</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=envoy-指标>Envoy 指标</h1><h2 id=envoy-指标概述>Envoy 指标概述</h2><p>Envoy 的主要目标之一是使网络易于理解。 Envoy 会根据其配置方式产生大量统计信息。一般来说，统计数据(指标)分为三类：</p><ul><li><strong>Downstream</strong>：Downstream 指标与外来的连接/请求有关。它们由 <code>listener</code>、<code>HTTP connection manager(HCM)</code>、<code>TCP proxy filter</code> 等产生。</li><li><strong>Upstream</strong>：Upstream 指标与外向的连接/请求有关。它们由 <code>connection pool</code>、<code>router filter</code>、<code>tcp proxy filter</code>等产生。</li><li><strong>Server</strong>：<code>Server</code> 指标信息描述 Envoy 服务器实例的运作情况。服务器正常运行时间或分配的内存量等统计信息。</li></ul><p>在最简单场景下，单个 Envoy Proxy 通常涉及 <code>Downstream</code> 和 <code>Upstream</code> 统计数据。这两种指标反映了取该 <code>网络节点</code> 的运行情况。来自整个网格的统计数据提供了每个<code> 网络节点</code> 和整体网络健康状况的非常详细的汇总信息。Envoy 的文档对这些指标有一些简单的说明。</p><h3 id=tag>Tag</h3><p>Envoy 的指标还有两个子概念，支持在指标中使用： <code>标签(tags)</code>/<code>维度(dimensions)</code> 。这里的 <code>tags</code> 对等于 Prometheus 指标的 label。意义上，可以理解为：分类维度。</p><p>Envoy 的 <code>指标</code> 由规范的字符串来标识。这些字符串的动态部分（子字符串）被提取成为 <code>标签(tag)</code>。可以通过指定 <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#envoy-v3-api-msg-config-metrics-v3-tagspecifier target=_blank rel="external nofollow noopener noreferrer">tag 提取规则(Tag Specifier configuration.)</a> 来定制 tag 。</p><p>举个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>### 1. 原始的 Envoy 指标 ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl <span class=nb>exec</span> fortio-server -c istio-proxy -- curl <span class=s1>&#39;localhost:15000/stats&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 返回：</span>
</span></span><span class=line><span class=cl>cluster.outbound<span class=p>|</span>8080<span class=o>||</span>fortio-server-l2.mark.svc.cluster.local.external.upstream_rq_2xx: <span class=m>300</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 其中：</span>
</span></span><span class=line><span class=cl><span class=c1># - `outbound|8080||fortio-server-l2.mark.svc.cluster.local` 部分是 upstream cluster 的名字。可以正则提取作为 tag。</span>
</span></span><span class=line><span class=cl><span class=c1># - `2xx` 部分是 HTTP Status Code 的分类。可以正则提取作为 tag。 下文将有这个提取规则的配置说明。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### 2. 给 Prometheus 的指标 ###</span>
</span></span><span class=line><span class=cl>$ kubectl <span class=nb>exec</span> fortio-server -c istio-proxy -- curl <span class=s1>&#39;localhost:15000/stats?format=prometheus&#39;</span> <span class=p>|</span> grep <span class=s1>&#39;outbound|8080||fortio-server-l2&#39;</span> <span class=p>|</span> grep <span class=s1>&#39;external.upstream_rq&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 返回：</span>
</span></span><span class=line><span class=cl>envoy_cluster_external_upstream_rq<span class=o>{</span><span class=nv>response_code_class</span><span class=o>=</span><span class=s2>&#34;2xx&#34;</span>,cluster_name<span class=o>=</span><span class=s2>&#34;outbound|8080||fortio-server-l2.mark.svc.cluster.local&#34;</span><span class=o>}</span> <span class=m>300</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=指标数据类型>指标数据类型</h3><p>Envoy 发出三种类型的值作为统计信息：</p><ul><li><strong>计数器(Counters)</strong>：无符号整数，只会增加而不会减少。例如，总请求。</li><li><strong>仪表(Gauges)</strong>：增加和减少的无符号整数。例如，当前活动的请求。</li><li><strong>直方图(Histograms)</strong>：作为指标流的一部分的无符号整数，然后由收集器聚合以最终产生汇总的百分位值(percentile，即平常说的 P99/P50/Pxx)。例如，<code>Upsteam</code> 响应时间。</li></ul><p>在 Envoy 的内部实现中，Counters 和 Gauges 被分批并定期刷新以提高性能。Histograms 在接收时写入。</p><h2 id=指标释义>指标释义</h2><p>从指标的产出地点来划分，可以分为：</p><ul><li>cluster manager : 面向 <code>upstream</code> 的 L3/L4/L7 层指标</li><li>http connection manager(HCM) ： 面向 <code>upstream</code> & <code>downstream</code> 的 L7 层指标</li><li>listeners : 面向 <code>downstream</code> 的 L3/L4 层指标</li><li>server(全局)</li><li>watch dog</li></ul><p>下面我只选择了部分关键的性能指标来简单说明。</p><h3 id=cluster-manager>cluster manager</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_stats target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:cluster manager stats</a></p><p>上面文档已经说得比较详细了。我只补充一些在性能调优时需要关注的方面。那么，一般需要关注什么指标？</p><p>我们从著名的 <a href=https://www.brendangregg.com/usemethod.html target=_blank rel="external nofollow noopener noreferrer">Utilization Saturation and Errors (USE)</a> 方法学来分析。</p><p>利用率(Utilization):</p><ul><li><code>upstream_cx_total</code> (Counter): 连接数</li><li><code>upstream_rq_active</code></li></ul><p>饱和度(Saturation):</p><ul><li><code>upstream_rq_time</code> (Histogram): 响应时间</li><li><code>upstream_cx_connect_ms</code> (Histogram)</li><li><code>upstream_cx_rx_bytes_buffered</code></li><li><code>upstream_cx_tx_bytes_buffered</code></li><li><code>upstream_rq_pending_total</code></li><li><code>upstream_rq_pending_active</code> (Gauge)</li></ul><p>错误(Error):</p><ul><li><code>upstream_cx_connect_fail</code> (Counter): 连接失败数</li><li><code>upstream_cx_connect_timeout</code> (Counter): 连接超时数</li><li><code>upstream_cx_overflow</code> (Counter): 集群连接断路器溢出的总次数</li><li><code>upstream_cx_pool_overflow</code></li><li><code>upstream_cx_destroy_local_with_active_rq</code></li><li><code>upstream_cx_destroy_remote_with_active_rq</code></li><li><code>upstream_rq_timeout</code></li><li><code>upstream_rq_retry</code></li><li><code>upstream_rq_rx_reset</code></li><li><code>upstream_rq_tx_reset</code></li></ul><p>其它：</p><ul><li><code>upstream_rq_total</code> (Counter): TPS (吞吐)</li><li><code>upstream_cx_destroy_local</code> (Counter): Envoy 主动断开的连接计数</li><li><code>upstream_cx_destroy_remote</code> (Counter): Envoy 被动断开的连接计数</li><li><code>upstream_cx_length_ms</code> (Histogram)</li></ul><h3 id=http-connection-managerhcm>http connection manager(HCM)</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/stats target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:http connection manager(HCM) stats</a></p><p>可以认为，这是面向 <code>downstream</code> & 部分 <code>upstream</code> 的 L7 层指标</p><p>利用率(Utilization):</p><ul><li><code>downstream_cx_total</code></li><li><code>downstream_cx_active</code></li><li><code>downstream_cx_http1_active</code></li><li><code>downstream_rq_total</code></li><li><code>downstream_rq_http1_total</code></li><li><code>downstream_rq_active</code></li></ul><p>饱和度(Saturation):</p><ul><li><code>downstream_cx_rx_bytes_buffered</code></li><li><code>downstream_cx_tx_bytes_buffered</code></li><li><code>downstream_flow_control_paused_reading_total</code></li><li><code>downstream_flow_control_resumed_reading_total</code></li></ul><p>错误(Error):</p><ul><li><code>downstream_cx_destroy_local_active_rq</code></li><li><code>downstream_cx_destroy_remote_active_rq</code></li><li><code>downstream_rq_rx_reset</code></li><li><code>downstream_rq_tx_reset</code></li><li><code>downstream_rq_too_large</code></li><li><code>downstream_rq_max_duration_reached</code></li><li><code>downstream_rq_timeout</code></li><li><code>downstream_rq_overload_close</code></li><li><code>rs_too_large</code></li></ul><p>其它：</p><ul><li><code>downstream_cx_destroy_remote</code></li><li><code>downstream_cx_destroy_local</code></li><li><code>downstream_cx_length_ms</code></li></ul><h3 id=listeners>listeners</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/stats target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:listener stats</a></p><p>可以认为，这是 downstream 的 L3/L4 层的指标。</p><p>利用率(Utilization):</p><ul><li><code>downstream_cx_total</code></li><li><code>downstream_cx_active</code></li></ul><p>饱和度(Saturation):</p><ul><li><code>downstream_pre_cx_active</code></li></ul><p>错误(Error):</p><ul><li><code>downstream_cx_transport_socket_connect_timeout</code></li><li><code>downstream_cx_overflow</code></li><li><code>no_filter_chain_match</code></li><li><code>downstream_listener_filter_error</code></li><li><code>no_certificate</code></li></ul><p>其它：</p><ul><li><code>downstream_cx_length_ms</code></li></ul><h3 id=server>server</h3><p>Envoy 基础信息指标</p><p><a href=https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/statistics target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:server stats</a></p><p>利用率(Utilization):</p><ul><li><code>concurrency</code></li></ul><p>错误(Error):</p><ul><li><code>days_until_first_cert_expiring</code></li></ul><h3 id=watch-dog>watch dog</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/operations/performance target=_blank rel="external nofollow noopener noreferrer">Envoy 文档: Watchdog</a></p><p>Envoy 还包括一个可配置的看门狗系统，它可以在 Envoy 没有响应时增加统计数据并选择性地终止服务器。 系统有两个独立的看门狗配置，一个用于主线程，一个用于工作线程； 因为不同的线程有不同的工作负载。 这些统计数据有助于从高层次上理解 Envoy 的事件循环是否因为它正在做太多工作、阻塞或没有被操作系统调度而没有响应。</p><p>饱和度(Saturation):</p><ul><li><code>watchdog_mega_miss</code>(Counter): mega 未命中数</li><li><code>watchdog_miss</code>(Counter): 未命中数</li></ul><p>如果你对 watchdog 机制的兴趣，可以参考：</p><blockquote><p><a href=https://github.com/envoyproxy/envoy/issues/11391 target=_blank rel="external nofollow noopener noreferrer">https://github.com/envoyproxy/envoy/issues/11391</a>
<a href=https://github.com/envoyproxy/envoy/issues/11388 target=_blank rel="external nofollow noopener noreferrer">https://github.com/envoyproxy/envoy/issues/11388</a></p></blockquote><h3 id=event-loop>Event loop</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/operations/performance target=_blank rel="external nofollow noopener noreferrer">Envoy 文档: Event loop</a></p><p>Envoy 架构旨在通过在少量线程上运行事件循环来优化可扩展性和资源利用率。 <code>"main"</code> 线程负责控制面处理，每个 <code>"worker"</code> 线程分担数据面的一部分任务。 Envoy 公开了两个统计信息来监控所有这些线程事件循环的性能。</p><p>跑一轮循环的耗时：事件循环的每次迭代都会执行一些任务。任务数量会随着负载的变化而变化。但是，如果一个或多个线程具有异常长尾循环执行耗时，则可能存在性能问题。例如，负责可能在工作线程之间分配不均，或者插件中可能存在长时间阻塞操作阻碍了任务进度。</p><p>轮询延迟：在事件循环的每次迭代中，事件调度程序都会轮询 I/O 事件，并在某些 <code>I/O 事件就绪</code> 或 发生 <code>超时</code> 时 &ldquo;唤醒&rdquo; 线程，以先发生者为准。在 <code>超时</code> 的情况下，我们可以测量轮询后预期唤醒时间与实际唤醒时间的差值；这种差异称为 &ldquo;<code>轮询延迟</code>"。看到一些小的 <code>轮询延迟</code> 是正常的，通常等于内核调度程序的 &ldquo;时间片(time slice&rdquo;)&rdquo; 或 &ldquo;量子(quantum)&rdquo; ——这取决于运行 Envoy 的操作系统 —— 但如果这个数字大大高于其正常观察到的基线，它表示内核调度程序可能发生延迟。</p><p>可以通过将 <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/bootstrap/v3/bootstrap.proto#envoy-v3-api-field-config-bootstrap-v3-bootstrap-enable-dispatcher-stats target=_blank rel="external nofollow noopener noreferrer">enable_dispatcher_stats</a> 设置为 <code>true</code> 来启用这些统计信息。</p><ul><li><code>main</code> 线程的事件调度器有一个以 <code>server.dispatcher.</code> 为根的统计树。</li><li>每个 <code>worker</code> 线程的事件调度器都有一个以 <code>listener_manager.worker_&lt;id>.dispatcher.</code> 为根的统计树。</li></ul><p>每棵树都有以下统计信息：</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>loop_duration_us</td><td>Histogram</td><td>以微秒为单位的事件循环持续时间</td></tr><tr><td>poll_delay_us</td><td>Histogram</td><td>以微秒为单位的轮询延迟</td></tr></tbody></table><p>请注意，此处不包括任何辅助(非 main 与 worker)线程。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Watch Dog 和 Event loop 都是解决与监控事件处理延迟与时效的工具，这里有很多细节和故事，甚至可以说到 Linux Kernel。希望本书后面有时间，可以和大家一起学习和分析这些有趣的细节。
</span></span></code></pre></td></tr></table></div></div><h2 id=配置说明>配置说明</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>本节参考：
</span></span><span class=line><span class=cl>[Envoy 文档](https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto)
</span></span></code></pre></td></tr></table></div></div><h3 id=configbootstrapv3bootstrap>config.bootstrap.v3.Bootstrap</h3><p><a href=https://github.com/envoyproxy/envoy/blob/255af425e1d51066cc8b69a39208b70e18d07073/api/envoy/config/bootstrap/v3/bootstrap.proto#L44 target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:config.bootstrap.v3.Bootstrap proto</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;node&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;static_resources&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dynamic_resources&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cluster_manager&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_sinks&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_config&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_flush_interval&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_flush_on_admin&#34;</span><span class=p>:</span> <span class=err>...</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>什么是 `stats sink`？ 本书不作说明。Istio 默认没定制相关配置。以下只说关注的部分配置。
</span></span></code></pre></td></tr></table></div></div><ul><li><p>stats_config
(<a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#envoy-v3-api-msg-config-metrics-v3-statsconfig target=_blank rel="external nofollow noopener noreferrer">config.metrics.v3.StatsConfig</a>) 用于内部处理统计信息的配置。</p></li><li><p>stats_flush_interval
(<a href=https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#duration target=_blank rel="external nofollow noopener noreferrer">Duration</a>) 刷新 <code>stats sink</code> 的时间间隔。。出于性能原因，Envoy 不会实时刷新 counter ，仅定期刷新 counter 和 gauge 。 如果未指定，则默认值为 5000 毫秒。 <code>stats_flush_interval</code> 或 <code>stats_flush_on_admin</code> 只能设置之一。 Duration 必须至少为 1 毫秒，最多为 5 分钟。</p></li><li><p>stats_flush_on_admin
(<a href=https://developers.google.com/protocol-buffers/docs/proto#scalar target=_blank rel="external nofollow noopener noreferrer">bool</a>) 仅当在 <code>管理界面(admin interface)</code> 上查询时才将统计信息刷新到 <code>sink</code>。 如果设置，则不会创建刷新计时器。 只能设置 <code>stats_flush_on_admin</code> 或 <code>stats_flush_interval</code> 之一。</p></li></ul><h3 id=configmetricsv3statsconfig>config.metrics.v3.StatsConfig</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#config-metrics-v3-statsconfig target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:config-metrics-v3-statsconfig</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_tags&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;use_all_default_tags&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;stats_matcher&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;histogram_bucket_settings&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>stats_tags - 维度提取规则(对应 Prometheus 的 label 提取)
(<strong>多个</strong> <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#envoy-v3-api-msg-config-metrics-v3-tagspecifier target=_blank rel="external nofollow noopener noreferrer">config.metrics.v3.TagSpecifier</a> ) 每个 <code>指标名称字符串</code> 都通过这些标签规则独立处理。 当一个标签匹配时，第一个捕获组不会立即从名称中删除，所以后面的 <a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#envoy-v3-api-msg-config-metrics-v3-tagspecifier target=_blank rel="external nofollow noopener noreferrer">TagSpecifiers</a> 也可以重复匹配同一部分。在完成所有标签匹配后，再剪裁 <code>指标名称字符串</code> 的匹配部分，并作为 <code>stats sink</code> 的指标名，例如 Prometheus的指标名。</p></li><li><p>use_all_default_tags
(BoolValue) 使用 Envoy 中指定的所有默认标签正则表达式。 这些可以与 stats_tags 中指定的自定义标签结合使用。 它们将在自定义标签之前进行处理。Istio 默认为 false.</p></li><li><p>stats_matcher
(<a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#envoy-v3-api-msg-config-metrics-v3-statsmatcher target=_blank rel="external nofollow noopener noreferrer">config.metrics.v3.StatsMatcher</a>) 指定 Envoy 要产出哪些指标。支持 <code>包含</code>/<code>排除</code> 规则指定。 如果未提供，则所有指标都将产出。 阻止某些指标集的统计可以提高一点 Envoy 运行性能。</p></li></ul><h3 id=configmetricsv3statsmatcher>config.metrics.v3.StatsMatcher</h3><p><a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/metrics/v3/stats.proto#config-metrics-v3-statsmatcher target=_blank rel="external nofollow noopener noreferrer">Envoy 文档:config-metrics-v3-statsmatcher</a></p><p>用于禁用/开启统计指标计算与产出的配置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;reject_all&#34;</span><span class=p>:</span> <span class=err>...</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;exclusion_list&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inclusion_list&#34;</span><span class=p>:</span> <span class=p>{</span><span class=err>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>reject_all
(<a href=https://developers.google.com/protocol-buffers/docs/proto#scalar target=_blank rel="external nofollow noopener noreferrer">bool</a>) 如果 <code>reject_all</code> 为 true ，则禁用所有统计信息。 如果 <code>reject_all</code> 为 false，则启用所有统计信息。</p></li><li><p>exclusion_list
(<a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/string.proto#envoy-v3-api-msg-type-matcher-v3-liststringmatcher target=_blank rel="external nofollow noopener noreferrer">type.matcher.v3.ListStringMatcher</a>) 排除列表</p></li><li><p>inclusion_list
(<a href=https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/string.proto#envoy-v3-api-msg-type-matcher-v3-liststringmatcher target=_blank rel="external nofollow noopener noreferrer">type.matcher.v3.ListStringMatcher</a>) 包含列表</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>本节参考了： https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>下一节，将以 Istio 如何使用上面的配置为例，举例说明。
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-09-13 10:46:39">更新于 2022-09-13</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/0affe7/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标 data-hashtags=istio,envoy,转载><i class="fa-brands fa-twitter fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.alongparty.cn/posts/0affe7/ data-hashtag=istio><i class="fa-brands fa-facebook-square fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标 data-web><i class="fa-brands fa-whatsapp fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标><i class="fa-brands fa-weibo fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标 data-description><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a>
<a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标 data-description><i class="fa-brands fa-blogger fa-fw"></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.alongparty.cn/posts/0affe7/ data-title=Envoy性能指标><i class="fa-brands fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw"></i>&nbsp;<a href=/tags/istio/>istio</a>,&nbsp;<a href=/tags/envoy/>envoy</a>,&nbsp;<a href=/tags/%E8%BD%AC%E8%BD%BD/>转载</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/6be15f/ class=prev rel=prev title=Istio组件详解><i class="fa-solid fa-angle-left fa-fw"></i>Istio组件详解</a>
<a href=/posts/6899d1/ class=next rel=next title=Istio性能指标>Istio性能指标<i class="fa-solid fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=kbsonlong/devops.alongparty.cn data-repo-id=R_kgDOHE7F-Q data-category=Announcements data-category-id=DIC_kwDOHE7F-c4CPP5J data-mapping=title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright"><i class="fa-regular fa-copyright fa-fw"></i>
<span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>kbsonlong</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw"></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin fa-fw"></i></span></span></div><div class="footer-line beian"><span class="icp footer-divider"><a target=_blank href=https://beian.miit.gov.cn/>粤ICP备18122209号</a></span></div></div></footer></div><div class=widgets><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fa-solid fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fa-solid fa-comment fa-fw"></i></a></div><a href=https://github.com/kbsonlong title="在 GitHub 上查看源代码" target=_blank rel="external nofollow noopener noreferrer" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js defer></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=/lib/pangu/pangu.min.js defer></script><script type=text/javascript src=/lib/cell-watermark/watermark.min.js defer></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{giscus:{darkTheme:"dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,enablePangu:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"WFOR67TML1",algoliaIndex:"along",algoliaSearchKey:"ea1fe535f9a7ae353f3922489c829cc1",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/favicon-16x16.png" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/_custom.min.js defer></script></body></html>